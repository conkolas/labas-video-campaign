function render(e){e?(requestId=requestAnimationFrame(render),targetStep!=step&&(targetStep>step?step+=Math.round(Math.cbrt(targetStep-step)):step-=Math.round(Math.cbrt(step-targetStep))),changeFrame(),step>=seqEndStep-1&&!seqEndCalled&&"function"==typeof seqEndCallback&&(seqEndCalled=!0,seqEndCallback())):window.cancelAnimationFrame(requestId)}function changeFrame(){var e=Math.round(step);"undefined"!=typeof images[currentSeq-1]&&"undefined"!=typeof images[currentSeq-1][e]&&context&&(context.fillStyle=images[currentSeq-1][e],context.fill())}function changeCanvas(e){context=contexts[e],bufferCanvas=bufferCanvases[e],bufferContext=bufferContexts[e]}function setCanvas(e){var t=document.getElementById("seq-"+e);t.width=contextW,t.height=contextH,contexts[e]=t.getContext("2d"),contexts[e].rect(0,0,contextW,contextH),bufferCanvases[e]=document.createElement("canvas"),bufferCanvases[e].width=parseInt($(".seq-holder.seq-"+e).data("frames"),10)*contextW,bufferCanvases[e].height=contextH,bufferContexts[e]=bufferCanvases[e].getContext("2d"),bufferContexts[e].rect(0,0,bufferCanvases[e].width,bufferCanvases[e].height)}function resizeVideo(){var e=$("#video-holder"),t=$(".seq-holder"),n=$(window),s=n.width()/n.height(),a=1920,r=1080,o=a/r;if(o>s)var i=n.height()*o,d=n.height(),l=(i-n.width())/2,c=0;else var i=n.width(),d=n.width()/o,l=0,c=-(d-n.height())/2;d=Math.round(d),i=Math.round(i),l=Math.round(l),c=Math.round(c),e.css({height:d,width:i,left:-l,top:c}),t.css({height:d,width:i,left:-l,top:c}),contextW=i,contextH=d}function startSequence1(){$(".seq-holder.seq-1").addClass("show"),seqActive=!0,seqCalled1=!0,currentSeq=1,seqEndStep=$(".seq-holder.seq-1").data("frames"),video.pause(),$(".seq-holder.seq-1 .icon-pop").addClass("animate"),$(".seq-holder.seq-1 .icon-pop").one("webkitAnimationEnd oanimationend oAnimationEnd msAnimationEnd animationend",function(e){initSlider()}),setTimeout(function(){video.currentTime=seqStart1+seqDuration1,video.play(),video.pause()},1e3),seqEndCallback=endSequence1}function startSequence2(){$(".seq-holder.seq-2").addClass("show"),$(".seq-holder.seq-2 .mic-request").addClass("animate"),seqActive=!0,seqCalled2=!0,currentSeq=2,seqEndStep=100,seqEndCallback=endSequence2,video.pause(),$(".seq-holder.seq-2 .skip-text").bind("click tap",function(){seqEndCallback=skipSequence2,targetStep=seqEndStep}),navigator.getUserMedia||(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.mediaDevices.getUserMedia),navigator.getUserMedia?navigator.getUserMedia({audio:!0},function(e){$(".seq-holder.seq-2 .mic-request").removeClass("animate"),$(".seq-holder.seq-2 .mic-ui").addClass("animate"),start_microphone(e)},function(e){seqEndCallback=skipSequence2,targetStep=seqEndStep}):(seqEndCallback=skipSequence2,targetStep=seqEndStep)}function startSequence3(){$(".seq-holder.seq-3").addClass("show"),seqActive=!0,seqCalled3=!0,currentSeq=3,textLength=50,seqEndStep=$(".seq-holder.seq-3").data("frames"),video.pause(),stepSmoothing=5,endStep=seqEndStep/100,textStep=100/textLength;var e=null;$("#seq-text").val(""),$("#seq-text").bind("input propertychange",function(){var t=this;e&&clearTimeout(e),e=setTimeout(function(){textEndStep=endStep*Math.round(textStep*t.value.length),targetStepVal=Math.round(seqEndStep/100*textEndStep),targetStep=targetStepVal},300)}),setTimeout(function(){video.currentTime=seqStart3+seqDuration3,video.play(),video.pause()},100),seqEndCallback=endSequence3}function startSequence4(){$(".seq-holder.seq-4").addClass("show"),$(".seq-holder.seq-4 .phone-button").addClass("animate"),seqActive=!0,seqCalled4=!0,currentSeq=4,seqEndStep=10,$(".seq-holder.seq-4 .phone-button").bind("click tap",function(){targetStep=seqEndStep}),video.pause(),seqEndCallback=endSequence4}function startSequence5(){$(".seq-holder.seq-5").addClass("show"),seqActive=!0,seqCalled5=!0,currentSeq=5,seqEndStep=10;var e=3e3,t=2e3,n=1e3,s=1500,a=500,r=[];r[1]=e,r[2]=t,r[3]=n,r[4]=s,r[5]=a;var o=1;$(".seq-holder.seq-5 .test-holder").addClass("active"),$(".seq-holder.seq-5 .progress-circle-"+o).addClass("active"),$(".seq-holder.seq-5 .question-"+o).addClass("active"),$(".seq-holder.seq-5 .button").bind("click tap",function(){playingStep||(playStep(o,r),o++)}),video.pause(),seqEndCallback=endSequence5}function startSequence6(){$(".seq-holder.seq-6").addClass("show"),seqActive=!0,seqCalled6=!0,currentSeq=6,seqEndStep=10,seqEndCallback=endSequence6}function playStep(e,t){playingStep=!0,video.play(),$(".seq-holder.seq-5 .progress-circle-"+e+" circle").attr("style","transition: stroke-dashoffset "+t[e]/1e3+"s ease;"),setStepProgressValue(e,100),$(".seq-holder.seq-5 .progress-circle-"+e+" .progress-bar").one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){$(".seq-holder.seq-5 .progress-circle-"+e).removeClass("active").addClass("passed"),$(".seq-holder.seq-5 .question-"+e).addClass("passed").removeClass("active"),$(".seq-holder.seq-5 .progress-circle-"+(e+1)).addClass("active"),$(".seq-holder.seq-5 .question-"+(e+1)).addClass("active"),e==t.length-1?targetStep=seqEndStep:video.pause(),playingStep=!1})}function setStepProgressValue(e,t){var e=$(".seq-holder.seq-5 .progress-circle-"+e+" .progress-bar"),n=parseInt(e.attr("stroke-dasharray"),10);e.css("stroke-dashoffset",n-Math.round(n/100*t))}function setProgressValue(e,t){var n=t,s=e.find(".svg .bar");if(isNaN(n))n=100;else{var a=s.data("size"),r=s.data("max");s.attr("r"),parseInt(s.attr("stroke-dasharray"));0>n&&(n=0),n>100&&(n=100);var o=r/100*n;0>o&&(o=0),o>r&&(o=r),s.attr("stroke-dasharray",o+","+a)}}function updateMicUI(e){var t=Math.round(e),n=50;t>n&&(t=n),0>t&&(t=0);var s=1;targetVol=t,currentVol=oldMicVol,oldMicVol=t;var a=targetVol-currentVol;0>a&&(s=-1),clearInterval(micUIInterval),micUIInterval=setInterval(function(){currentVol+=s,currentVol>targetVol&&(currentVol=targetVol),0>currentVol&&(currentVol=0),currentVol>=n&&(clearInterval(micUIInterval),stop_microphone()),currentVol>=n?(targetStep=seqEndStep,setProgressValue($(".seq-holder.seq-"+currentSeq+" .progress-circle"),100),$(".seq-holder.seq-"+currentSeq+" .value-circle .value").html(n)):(setProgressValue($(".seq-holder.seq-"+currentSeq+" .progress-circle"),100/n*currentVol),$(".seq-holder.seq-"+currentSeq+" .value-circle .value").html(currentVol))},300/Math.abs(a))}function start_microphone(e){microphone_stream=audioContext.createMediaStreamSource(e),analyserNode=audioContext.createAnalyser(),analyserNode.smoothingTimeConstant=.3,analyserNode.fftSize=1024,microphone_stream.connect(analyserNode),levelChecker=audioContext.createScriptProcessor(4096,1,1);var t=new Uint8Array(1),n=0,s=0,a=0;analyserNode.connect(levelChecker),microphone_stream.connect(levelChecker),levelChecker.connect(audioContext.destination);var r=null,o=!1;setProgressValue($(".seq-2 .progress-circle"),80),levelChecker.onaudioprocess=function(e){analyserNode.getByteFrequencyData(t),n=t[0],s=n/255,a=analyserNode.minDecibels+(analyserNode.maxDecibels-analyserNode.minDecibels)*s+Math.abs(analyserNode.minDecibels),o||(o=!0,r=setTimeout(function(){o=!1,updateMicUI(a)},300))}}function stop_microphone(){"closed"!=audioContext.state&&audioContext.close(),levelChecker=null}function initSlider(){$(".seq-holder.seq-"+currentSeq+" .slider").roundSlider({sliderType:"min-range",circleShape:"full",min:0,max:100,value:0,showTooltip:!1,keyboardAction:!1,startAngle:73,endAngle:117,radius:360,width:2,step:1,stop:function(){100!=this.options.value&&(targetStep=0,$(".seq-holder.seq-"+currentSeq+" .circle").css("opacity",.05),$(".seq-holder.seq-"+currentSeq+" .slider").roundSlider("option",{value:0})),$(".rs-handle").removeClass("rs-focus")},drag:function(){targetStep=Math.max(Math.round(seqEndStep/100*this.getValue()),1);var e=Math.max(.05,Math.min(.9,this.getValue()/100)).toFixed(2);$(".seq-holder.seq-"+currentSeq+" .circle").css("opacity",e)},create:function(){$(".seq-holder.seq-"+currentSeq+" .slider-holder").addClass("active"),$(".seq-holder.seq-"+currentSeq+" .slider-holder .slider-circle").addClass("animate")}})}function releaseSlider(e){var t=e,n=setInterval(function(){targetStep=Math.max(Math.round(seqEndStep/100*t),1),t--,0>=t&&(clearInterval(n),targetStep=Math.max(Math.round(seqEndStep/100*0),1))},1e3/fps)}function checkLoginState(){FB.getLoginStatus(function(e){statusChangeCallback(e)})}function statusChangeCallback(e){"connected"!=e.status?FB.login(function(e){checkLoginState()},{scope:"public_profile,rsvp_event,user_events"}):(accessToken=e.authResponse.accessToken,fbUserMe())}function fbUserMe(){FB&&FB.api("/me?access_token="+accessToken,function(e){e&&!e.error&&(console.log(e),fbUserEvents(e.id),fbAttendEvent(e.id))})}function fbUserEvents(e){FB&&FB.api("/"+e+"/events?access_token="+accessToken,function(e){e&&console.log(e)})}function fbAttendEvent(e){FB&&FB.api("/1520701134916550?access_token="+accessToken,function(e){e&&console.log(e)})}function pad(e,t){for(var n=""+e;n.length<t;)n="0"+n;return n}var fps=120,frameVelocity=10,imagesLoaded=0,totalFrames=0,step=1,targetStep=1,currentSeq=1,video=null,seqActive=!1,seqEndStep=1,seqEndCallback=null,stepSmoothing=5,canvas=null,context=null,bufferCanvas=null,bufferContext=null,contextW=0,contextH=0,canvases=[],contexts=[],bufferCanvases=[],bufferContexts=[],videoLoaded=!1,seqCalled1=!1,seqStart1=4,seqEnd1=6.55,seqDuration1=seqEnd1-seqStart1,seqCalled2=!1,seqStart2=14,seqEnd2=14,seqDuration2=seqEnd2-seqStart2,seqCalled3=!1,seqStart3=220.12,seqEnd3=240.24,seqDuration3=seqEnd3-seqStart3,seqCalled4=!1,seqStart4=7.5,seqEnd4=7.5,seqDuration4=seqEnd4-seqStart4,seqCalled5=!1,seqStart5=20,seqEnd5=20,seqDuration5=seqEnd5-seqStart5,seqCalled6=!1,seqStart6=32,seqEnd6=32,seqDuration6=seqEnd6-seqStart6,requestId=0,seqEndCalled=!1;$(window).load(function(){$(".loader").fadeOut(300,function(){startSequence6()})}),$(window).resize(function(){resizeVideo()});var releaseValue=0,endSequence1=function(){video.play(),seqEnd()},endSequence2=function(){$(".seq-holder.seq-2 .mic-request").removeClass("animate"),$(".seq-holder.seq-2 .mic-ui").removeClass("animate").one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){video.play(),seqEnd()})},skipSequence2=function(){$(".seq-holder.seq-2 .mic-request").removeClass("animate").one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){video.play(),seqEnd()})},endSequence3=function(){video.play(),seqEnd()},endSequence4=function(){$(".seq-holder.seq-4 .phone-button").removeClass("animate"),$(".seq-holder.seq-4 .phone-button").one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){setTimeout(function(){$(".seq-holder.seq-4").removeClass("show"),video.play(),seqEnd()},300)})},playingStep=!1,endSequence5=function(){$(".seq-holder.seq-5 .test-holder").removeClass("active").one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){seqEnd()})},endSequence6=function(){$(".seq-holder.seq-6").removeClass("show"),seqEnd()},decibelMeter=null,audioContext=new AudioContext,BUFF_SIZE=16384,audioInput=null,microphone_stream=null,gain_node=null,script_processor_node=null,script_processor_fft_node=null,analyserNode=null,levelChecker=null,noiseAverage=0,noiseAverageHit=0,noiseTimeoutSet=!1,noiseTimeout=0,noise=0,oldMicVol=0,targetVol=0,currentVol=0,micUIInterval=!1,dragTimeout,seqEnd=function(){render(!1),seqActive=!1,seqEndCallback=null,step=1,targetStep=1,seqEndStep=2;var e=50;setTimeout(function(){$(".seq-holder.seq-"+currentSeq).removeClass("show")},e)},accessToken=null;window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/fps)}}();